<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>mysql用法记录 | dio</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="image" href="/logo.jpeg">
    <meta name="description" content="wryyyyyyyyyyyyyyy!!!">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    
    <link rel="preload" href="/assets/css/0.styles.09e032e2.css" as="style"><link rel="preload" href="/assets/js/app.645d1ab6.js" as="script"><link rel="preload" href="/assets/js/3.ec5dfed0.js" as="script"><link rel="preload" href="/assets/js/2.0591ec21.js" as="script"><link rel="preload" href="/assets/js/1.e902e43f.js" as="script"><link rel="preload" href="/assets/js/54.714206a8.js" as="script"><link rel="prefetch" href="/assets/js/10.ec301330.js"><link rel="prefetch" href="/assets/js/13.6a2d2966.js"><link rel="prefetch" href="/assets/js/14.43f4c0c7.js"><link rel="prefetch" href="/assets/js/15.becd8c92.js"><link rel="prefetch" href="/assets/js/16.ea7147f2.js"><link rel="prefetch" href="/assets/js/17.039601cf.js"><link rel="prefetch" href="/assets/js/18.5720373b.js"><link rel="prefetch" href="/assets/js/19.966e3c1a.js"><link rel="prefetch" href="/assets/js/20.a73ff11e.js"><link rel="prefetch" href="/assets/js/21.b22ac23e.js"><link rel="prefetch" href="/assets/js/22.9996cb21.js"><link rel="prefetch" href="/assets/js/23.d9a9310e.js"><link rel="prefetch" href="/assets/js/24.c0d51d65.js"><link rel="prefetch" href="/assets/js/25.1b71e3b3.js"><link rel="prefetch" href="/assets/js/26.aca918a0.js"><link rel="prefetch" href="/assets/js/27.290cebe5.js"><link rel="prefetch" href="/assets/js/28.86d2c9e6.js"><link rel="prefetch" href="/assets/js/29.e2cf0e72.js"><link rel="prefetch" href="/assets/js/30.59496771.js"><link rel="prefetch" href="/assets/js/31.d6afc6b4.js"><link rel="prefetch" href="/assets/js/32.43cc4045.js"><link rel="prefetch" href="/assets/js/33.90b67e4f.js"><link rel="prefetch" href="/assets/js/34.d80cb6c8.js"><link rel="prefetch" href="/assets/js/35.4888dcf4.js"><link rel="prefetch" href="/assets/js/36.2caf63ff.js"><link rel="prefetch" href="/assets/js/37.55fc40cd.js"><link rel="prefetch" href="/assets/js/38.aca9300a.js"><link rel="prefetch" href="/assets/js/39.bc380f5c.js"><link rel="prefetch" href="/assets/js/4.f7a8284c.js"><link rel="prefetch" href="/assets/js/40.181b1ca9.js"><link rel="prefetch" href="/assets/js/41.070c61d7.js"><link rel="prefetch" href="/assets/js/42.09a18988.js"><link rel="prefetch" href="/assets/js/43.9cd4ab2e.js"><link rel="prefetch" href="/assets/js/44.058f7264.js"><link rel="prefetch" href="/assets/js/45.469766a1.js"><link rel="prefetch" href="/assets/js/46.45810457.js"><link rel="prefetch" href="/assets/js/47.d03efc75.js"><link rel="prefetch" href="/assets/js/48.7e6eb733.js"><link rel="prefetch" href="/assets/js/49.0d073e81.js"><link rel="prefetch" href="/assets/js/5.37896117.js"><link rel="prefetch" href="/assets/js/50.b55e9622.js"><link rel="prefetch" href="/assets/js/51.db6614f2.js"><link rel="prefetch" href="/assets/js/52.e415c208.js"><link rel="prefetch" href="/assets/js/53.534c8385.js"><link rel="prefetch" href="/assets/js/55.53a136c6.js"><link rel="prefetch" href="/assets/js/56.4bd04983.js"><link rel="prefetch" href="/assets/js/57.8e4314e1.js"><link rel="prefetch" href="/assets/js/58.6999e7eb.js"><link rel="prefetch" href="/assets/js/59.fd5b1045.js"><link rel="prefetch" href="/assets/js/6.faca5c55.js"><link rel="prefetch" href="/assets/js/60.55086e32.js"><link rel="prefetch" href="/assets/js/61.d8e68f3a.js"><link rel="prefetch" href="/assets/js/62.e200df6d.js"><link rel="prefetch" href="/assets/js/63.e63f9f6d.js"><link rel="prefetch" href="/assets/js/64.e1b61424.js"><link rel="prefetch" href="/assets/js/65.bde70c4c.js"><link rel="prefetch" href="/assets/js/66.abd13582.js"><link rel="prefetch" href="/assets/js/67.db010ee6.js"><link rel="prefetch" href="/assets/js/68.f8c0ee63.js"><link rel="prefetch" href="/assets/js/69.9ece5e34.js"><link rel="prefetch" href="/assets/js/7.d72bbe51.js"><link rel="prefetch" href="/assets/js/8.18180a48.js"><link rel="prefetch" href="/assets/js/9.31a767f4.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.470563c6.js">
    <link rel="stylesheet" href="/assets/css/0.styles.09e032e2.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar" data-v-2d5f533b><div data-v-2d5f533b><div id="loader-wrapper" class="loading-wrapper" data-v-d48f4d20 data-v-2d5f533b data-v-2d5f533b><div class="loader-main" data-v-d48f4d20><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div></div> <!----> <!----></div> <div class="password-shadow password-wrapper-out" style="display:none;" data-v-64685f0e data-v-2d5f533b data-v-2d5f533b><h3 class="title" style="display:none;" data-v-64685f0e data-v-64685f0e>dio</h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-64685f0e data-v-64685f0e><input type="password" value="" data-v-64685f0e> <span data-v-64685f0e>Konck! Knock!</span> <button data-v-64685f0e>OK</button></label> <div class="footer" style="display:none;" data-v-64685f0e data-v-64685f0e><span data-v-64685f0e><i class="iconfont reco-theme" data-v-64685f0e></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-64685f0e>vuePress-theme-reco</a></span> <span data-v-64685f0e><i class="iconfont reco-copyright" data-v-64685f0e></i> <a data-v-64685f0e><span data-v-64685f0e>dio</span>
            
          <span data-v-64685f0e>2022 - </span>
          2024
        </a></span></div></div> <div class="hide" data-v-2d5f533b><header class="navbar" data-v-2d5f533b><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.jpeg" alt="dio" class="logo"> <span class="site-name">dio</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      目录索引
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/go/" class="nav-link"><i class="iconfont undefined"></i>
  go
</a></li><li class="dropdown-item"><!----> <a href="/categories/kafka/" class="nav-link"><i class="iconfont undefined"></i>
  kafka
</a></li><li class="dropdown-item"><!----> <a href="/categories/mysql/" class="nav-link"><i class="iconfont undefined"></i>
  mysql
</a></li><li class="dropdown-item"><!----> <a href="/categories/其他/" class="nav-link"><i class="iconfont undefined"></i>
  其他
</a></li><li class="dropdown-item"><!----> <a href="/categories/php/" class="nav-link"><i class="iconfont undefined"></i>
  php
</a></li><li class="dropdown-item"><!----> <a href="/categories/redis/" class="nav-link"><i class="iconfont undefined"></i>
  redis
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  标签索引
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  时间线
</a></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-2d5f533b></div> <aside class="sidebar" data-v-2d5f533b><div class="personal-info-wrapper" data-v-ca798c94 data-v-2d5f533b><img src="/logo.jpeg" alt="author-avatar" class="personal-img" data-v-ca798c94> <h3 class="name" data-v-ca798c94>
    dio
  </h3> <div class="num" data-v-ca798c94><div data-v-ca798c94><h3 data-v-ca798c94>30</h3> <h6 data-v-ca798c94>Article</h6></div> <div data-v-ca798c94><h3 data-v-ca798c94>6</h3> <h6 data-v-ca798c94>Tag</h6></div></div> <hr data-v-ca798c94></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      目录索引
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/go/" class="nav-link"><i class="iconfont undefined"></i>
  go
</a></li><li class="dropdown-item"><!----> <a href="/categories/kafka/" class="nav-link"><i class="iconfont undefined"></i>
  kafka
</a></li><li class="dropdown-item"><!----> <a href="/categories/mysql/" class="nav-link"><i class="iconfont undefined"></i>
  mysql
</a></li><li class="dropdown-item"><!----> <a href="/categories/其他/" class="nav-link"><i class="iconfont undefined"></i>
  其他
</a></li><li class="dropdown-item"><!----> <a href="/categories/php/" class="nav-link"><i class="iconfont undefined"></i>
  php
</a></li><li class="dropdown-item"><!----> <a href="/categories/redis/" class="nav-link"><i class="iconfont undefined"></i>
  redis
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  标签索引
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  时间线
</a></div> <!----></nav> <!----> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-64685f0e data-v-2d5f533b><h3 class="title" style="display:none;" data-v-64685f0e data-v-64685f0e>mysql用法记录</h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-64685f0e data-v-64685f0e><input type="password" value="" data-v-64685f0e> <span data-v-64685f0e>Konck! Knock!</span> <button data-v-64685f0e>OK</button></label> <div class="footer" style="display:none;" data-v-64685f0e data-v-64685f0e><span data-v-64685f0e><i class="iconfont reco-theme" data-v-64685f0e></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-64685f0e>vuePress-theme-reco</a></span> <span data-v-64685f0e><i class="iconfont reco-copyright" data-v-64685f0e></i> <a data-v-64685f0e><span data-v-64685f0e>dio</span>
            
          <span data-v-64685f0e>2022 - </span>
          2024
        </a></span></div></div> <div data-v-2d5f533b><main class="page"><div class="page-title" style="display:none;"><h1 class="title">mysql用法记录</h1> <div data-v-3b7f5bdf><i class="iconfont reco-account" data-v-3b7f5bdf><span data-v-3b7f5bdf>dio</span></i> <i class="iconfont reco-date" data-v-3b7f5bdf><span data-v-3b7f5bdf>2019-02-12</span></i> <!----> <i class="iconfont reco-tag tags" data-v-3b7f5bdf><span class="tag-item" data-v-3b7f5bdf>mysql</span></i></div></div> <div class="theme-reco-content content__default" style="display:none;"><hr> <h2 id="简单"><a href="#简单" class="header-anchor">#</a> 简单</h2> <h3 id="组合两个表-175"><a href="#组合两个表-175" class="header-anchor">#</a> 组合两个表(175)</h3> <blockquote><p>无论person是否有值，都显示</p></blockquote> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> t1<span class="token punctuation">.</span>FirstName<span class="token punctuation">,</span> t1<span class="token punctuation">.</span>LastName<span class="token punctuation">,</span> t2<span class="token punctuation">.</span>City<span class="token punctuation">,</span> t2<span class="token punctuation">.</span>State
<span class="token keyword">FROM</span> person t1
	<span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> Address t2 <span class="token keyword">ON</span> t1<span class="token punctuation">.</span>PersonId <span class="token operator">=</span> t2<span class="token punctuation">.</span>PersonId
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="第二高的薪水-176"><a href="#第二高的薪水-176" class="header-anchor">#</a> 第二高的薪水(176)</h3> <blockquote><p>Salary 小于 最大值中的最大值就是第二高的</p></blockquote> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token function">MAX</span><span class="token punctuation">(</span>Salary<span class="token punctuation">)</span> <span class="token keyword">AS</span> SecondHighestSalary
<span class="token keyword">FROM</span> Employee
<span class="token keyword">WHERE</span> Salary <span class="token operator">&lt;</span> <span class="token punctuation">(</span>
	<span class="token keyword">SELECT</span> <span class="token function">MAX</span><span class="token punctuation">(</span>Salary<span class="token punctuation">)</span>
	<span class="token keyword">FROM</span> Employee
<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="第n高的薪水-177"><a href="#第n高的薪水-177" class="header-anchor">#</a> 第N高的薪水(177)</h3> <blockquote><p>根据薪水从高到低排序，取offset</p></blockquote> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token punctuation">(</span>
		<span class="token keyword">SELECT</span> <span class="token keyword">DISTINCT</span> Salary
		<span class="token keyword">FROM</span> Employee
		<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> Salary <span class="token keyword">DESC</span>
		<span class="token keyword">LIMIT</span> N<span class="token punctuation">,</span> <span class="token number">1</span>
	<span class="token punctuation">)</span> <span class="token keyword">AS</span> NthHighestSalary
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="超过经理收入的员工-181"><a href="#超过经理收入的员工-181" class="header-anchor">#</a> 超过经理收入的员工(181)</h3> <blockquote><p>自连表进行查询，t1为员工，t2为经理</p></blockquote> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> t1<span class="token punctuation">.</span>Name
<span class="token keyword">FROM</span> Employee t1<span class="token punctuation">,</span> Employee t2
<span class="token keyword">WHERE</span> t1<span class="token punctuation">.</span>ManagerId <span class="token operator">=</span> t2<span class="token punctuation">.</span>Id
	<span class="token operator">AND</span> t1<span class="token punctuation">.</span>Salary <span class="token operator">&gt;</span> t2<span class="token punctuation">.</span>Salary
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="查找重复的电子邮箱-182"><a href="#查找重复的电子邮箱-182" class="header-anchor">#</a> 查找重复的电子邮箱(182)</h3> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> Email <span class="token keyword">FROM</span> Person <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> Email <span class="token keyword">Having</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="从不订购的客户-183"><a href="#从不订购的客户-183" class="header-anchor">#</a> 从不订购的客户(183)</h3> <blockquote><p>使用not in</p></blockquote> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> t1<span class="token punctuation">.</span>Name
<span class="token keyword">FROM</span> Customers t1
<span class="token keyword">WHERE</span> t1<span class="token punctuation">.</span>Id <span class="token operator">NOT</span> <span class="token operator">IN</span> <span class="token punctuation">(</span>
	<span class="token keyword">SELECT</span> CustomerId
	<span class="token keyword">FROM</span> Orders
<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="上升的温度-197"><a href="#上升的温度-197" class="header-anchor">#</a> 上升的温度(197)</h3> <blockquote><p>查找昨天的温度比今天高的Id</p> <p>DATEDIFF(t1.date, t2.date) 两个日期相差天数</p></blockquote> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> t1<span class="token punctuation">.</span>id
<span class="token keyword">FROM</span> weather t1
	<span class="token keyword">JOIN</span> weather t2
	<span class="token keyword">ON</span> DATEDIFF<span class="token punctuation">(</span>t1<span class="token punctuation">.</span><span class="token keyword">date</span><span class="token punctuation">,</span> t2<span class="token punctuation">.</span><span class="token keyword">date</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">1</span>
	<span class="token operator">AND</span> t1<span class="token punctuation">.</span>Temperature <span class="token operator">&gt;</span> t2<span class="token punctuation">.</span>Temperature
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="删除重复邮箱-196"><a href="#删除重复邮箱-196" class="header-anchor">#</a> 删除重复邮箱(196)</h3> <blockquote><p>自连接</p></blockquote> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">DELETE</span> P1
<span class="token keyword">FROM</span> Person P1<span class="token punctuation">,</span> Person P2
<span class="token keyword">WHERE</span> P1<span class="token punctuation">.</span>Email <span class="token operator">=</span> P2<span class="token punctuation">.</span>Email
	<span class="token operator">AND</span> P1<span class="token punctuation">.</span>Id <span class="token operator">&gt;</span> P2<span class="token punctuation">.</span>Id
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><blockquote><p>查出重复邮箱中ID最大的，然后 使用 in 删除这些最大的Id</p></blockquote> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> person <span class="token keyword">WHERE</span> id <span class="token operator">in</span> 
<span class="token punctuation">(</span><span class="token keyword">SELECT</span> id <span class="token keyword">FROM</span> 
<span class="token punctuation">(</span> <span class="token keyword">SELECT</span> <span class="token keyword">DISTINCT</span> t1<span class="token punctuation">.</span>id <span class="token keyword">AS</span> id <span class="token keyword">FROM</span> person t1<span class="token punctuation">,</span>person t2
<span class="token keyword">WHERE</span> t1<span class="token punctuation">.</span>email<span class="token operator">=</span>t2<span class="token punctuation">.</span>email <span class="token operator">AND</span> t1<span class="token punctuation">.</span>id<span class="token operator">&gt;</span>t2<span class="token punctuation">.</span>id<span class="token punctuation">)</span> <span class="token keyword">AS</span> <span class="token keyword">temp</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="员工奖金-577"><a href="#员工奖金-577" class="header-anchor">#</a> 员工奖金(577)</h3> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> t1<span class="token punctuation">.</span>name<span class="token punctuation">,</span> t2<span class="token punctuation">.</span>bonus
<span class="token keyword">FROM</span> Employee t1
	<span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> Bonus t2 <span class="token keyword">ON</span> t1<span class="token punctuation">.</span>empId <span class="token operator">=</span> t2<span class="token punctuation">.</span>empId
<span class="token keyword">WHERE</span> t2<span class="token punctuation">.</span>bonus <span class="token operator">&lt;</span> <span class="token number">1000</span>
	<span class="token operator">OR</span> t2<span class="token punctuation">.</span>bonus <span class="token operator">IS</span> <span class="token boolean">NULL</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="寻找用户推荐人-584"><a href="#寻找用户推荐人-584" class="header-anchor">#</a> 寻找用户推荐人(584)</h3> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> name <span class="token keyword">FROM</span> customer <span class="token keyword">WHERE</span> referee_id <span class="token operator">&lt;&gt;</span> <span class="token number">2</span> <span class="token operator">OR</span> referee_id <span class="token operator">IS</span> <span class="token boolean">NULL</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="订单最多的客户-586"><a href="#订单最多的客户-586" class="header-anchor">#</a> 订单最多的客户(586)</h3> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> customer_number
<span class="token keyword">FROM</span> orders
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> customer_number
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">DESC</span>
<span class="token keyword">LIMIT</span> <span class="token number">1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="大的国家-595"><a href="#大的国家-595" class="header-anchor">#</a> 大的国家(595)</h3> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> name<span class="token punctuation">,</span>population<span class="token punctuation">,</span>area <span class="token keyword">FROM</span> World <span class="token keyword">WHERE</span> area <span class="token operator">&gt;=</span> <span class="token number">3000000</span> <span class="token operator">OR</span> population <span class="token operator">&gt;=</span> <span class="token number">25000000</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="超过5名学生的课-596"><a href="#超过5名学生的课-596" class="header-anchor">#</a> 超过5名学生的课(596)</h3> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> class <span class="token keyword">FROM</span> courses <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> class <span class="token keyword">Having</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token keyword">DISTINCT</span><span class="token punctuation">(</span>student<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">5</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="总体通过率-597"><a href="#总体通过率-597" class="header-anchor">#</a> 总体通过率(597)</h3> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token function">ROUND</span><span class="token punctuation">(</span> IFNULL<span class="token punctuation">(</span><span class="token punctuation">(</span>
		<span class="token keyword">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span>
		<span class="token keyword">FROM</span> <span class="token punctuation">(</span>
			<span class="token keyword">SELECT</span> <span class="token keyword">DISTINCT</span> requester_id<span class="token punctuation">,</span> accepter_id
			<span class="token keyword">FROM</span> request_accepted
		<span class="token punctuation">)</span> A
	<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span>
		<span class="token keyword">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span>
		<span class="token keyword">FROM</span> <span class="token punctuation">(</span>
			<span class="token keyword">SELECT</span> <span class="token keyword">DISTINCT</span> sender_id<span class="token punctuation">,</span> send_to_id
			<span class="token keyword">FROM</span> friend_request
		<span class="token punctuation">)</span> B
	<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> accept_rate<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="连续空余座位-603"><a href="#连续空余座位-603" class="header-anchor">#</a> 连续空余座位(603)</h3> <blockquote><p>只要挨着我的是空余的，那么就是连续座位</p> <p>利用 abs 相减 等于 1 即为相邻</p></blockquote> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token keyword">DISTINCT</span> t1<span class="token punctuation">.</span>seat_id
<span class="token keyword">FROM</span> cinema t1<span class="token punctuation">,</span> cinema t2
<span class="token keyword">WHERE</span> <span class="token punctuation">(</span>abs<span class="token punctuation">(</span>t1<span class="token punctuation">.</span>seat_id <span class="token operator">-</span> t2<span class="token punctuation">.</span>seat_id<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">1</span>
	<span class="token operator">AND</span> t1<span class="token punctuation">.</span>free <span class="token operator">=</span> <span class="token number">1</span>
	<span class="token operator">AND</span> t2<span class="token punctuation">.</span>free <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span>
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> t1<span class="token punctuation">.</span>seat_id
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="销售员-607"><a href="#销售员-607" class="header-anchor">#</a> 销售员(607)</h3> <blockquote><p>找出没有向 RED 公司销售过的员工</p></blockquote> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> name <span class="token keyword">FROM</span> salesperson <span class="token keyword">WHERE</span> sales_id <span class="token operator">NOT</span> <span class="token operator">IN</span> <span class="token punctuation">(</span>
    <span class="token keyword">SELECT</span> <span class="token keyword">distinct</span> sales_id <span class="token keyword">FROM</span> orders t1 <span class="token keyword">INNEr</span> <span class="token keyword">JOIN</span> company t2 <span class="token keyword">ON</span> t1<span class="token punctuation">.</span>com_id <span class="token operator">=</span> t2<span class="token punctuation">.</span>com_id  <span class="token operator">AND</span> t2<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'RED'</span>
<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="判断三角形-610"><a href="#判断三角形-610" class="header-anchor">#</a> 判断三角形(610)</h3> <blockquote><p>如果任意一个两边之和小于等于第三边的则不能构成</p></blockquote> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span><span class="token punctuation">,</span><span class="token keyword">IF</span><span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token operator">+</span>y<span class="token operator">-</span>z<span class="token operator">&lt;=</span><span class="token number">0</span> <span class="token operator">or</span> x<span class="token operator">+</span>z<span class="token operator">-</span>y<span class="token operator">&lt;=</span><span class="token number">0</span> <span class="token operator">or</span> y<span class="token operator">+</span>z<span class="token operator">-</span>x<span class="token operator">&lt;=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'No'</span><span class="token punctuation">,</span><span class="token string">'Yes'</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> triangle <span class="token keyword">FROM</span> triangle<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="直线上的最近距离-613"><a href="#直线上的最近距离-613" class="header-anchor">#</a> 直线上的最近距离(613)</h3> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token function">MIN</span><span class="token punctuation">(</span>abs<span class="token punctuation">(</span>t1<span class="token punctuation">.</span>x <span class="token operator">-</span> t2<span class="token punctuation">.</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> shortest <span class="token keyword">FROM</span> <span class="token keyword">point</span> t1<span class="token punctuation">,</span><span class="token keyword">point</span> t2 <span class="token keyword">WHERE</span> t1<span class="token punctuation">.</span>x <span class="token operator">&lt;&gt;</span> t2<span class="token punctuation">.</span>x<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="只出现过一次的最大数字-619"><a href="#只出现过一次的最大数字-619" class="header-anchor">#</a> 只出现过一次的最大数字(619)</h3> <blockquote><p>GROUP 找出出现过多次的，再使用 NOT IN 过滤掉这些</p></blockquote> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token function">MAX</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span> <span class="token keyword">AS</span> num
<span class="token keyword">FROM</span> my_numbers
<span class="token keyword">WHERE</span> num <span class="token operator">NOT</span> <span class="token operator">IN</span> <span class="token punctuation">(</span>
	<span class="token keyword">SELECT</span> num
	<span class="token keyword">FROM</span> my_numbers
	<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> num
	<span class="token keyword">HAVING</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">1</span>
<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="有趣的电影-620"><a href="#有趣的电影-620" class="header-anchor">#</a> 有趣的电影(620)</h3> <blockquote><p>找出id为奇数，且不无聊的电影</p></blockquote> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> cinema <span class="token keyword">WHERE</span> description <span class="token operator">&lt;&gt;</span> <span class="token string">'boring'</span> <span class="token operator">AND</span> id<span class="token operator">%</span><span class="token number">2</span><span class="token operator">&lt;&gt;</span><span class="token number">0</span> <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> rating <span class="token keyword">DESC</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="交换工资-627"><a href="#交换工资-627" class="header-anchor">#</a> 交换工资(627)</h3> <blockquote><p>将 f 和 m 的值互换</p></blockquote> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">UPDATE</span> salary <span class="token keyword">set</span> sex <span class="token operator">=</span> <span class="token keyword">IF</span><span class="token punctuation">(</span>sex<span class="token operator">=</span><span class="token string">'f'</span><span class="token punctuation">,</span> <span class="token string">'m'</span><span class="token punctuation">,</span> <span class="token string">'f'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="合作过至少三次的演员和导演-1050"><a href="#合作过至少三次的演员和导演-1050" class="header-anchor">#</a> 合作过至少三次的演员和导演(1050)</h3> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> actor_id<span class="token punctuation">,</span>director_id <span class="token keyword">FROM</span> ActorDirector <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> actor_id<span class="token punctuation">,</span>director_id <span class="token keyword">Having</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span><span class="token number">3</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="产品销售分析i-1068"><a href="#产品销售分析i-1068" class="header-anchor">#</a> 产品销售分析I(1068)</h3> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> t2<span class="token punctuation">.</span>product_name<span class="token punctuation">,</span>t1<span class="token punctuation">.</span><span class="token keyword">year</span><span class="token punctuation">,</span>t1<span class="token punctuation">.</span>price <span class="token keyword">FROM</span> Sales t1 <span class="token keyword">Left</span> <span class="token keyword">JOIN</span> Product t2 <span class="token keyword">ON</span> t1<span class="token punctuation">.</span>product_id <span class="token operator">=</span> t2<span class="token punctuation">.</span>product_id<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="产品销售分析ii-1069"><a href="#产品销售分析ii-1069" class="header-anchor">#</a> 产品销售分析II(1069)</h3> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> product_id<span class="token punctuation">,</span><span class="token function">SUM</span><span class="token punctuation">(</span>quantity<span class="token punctuation">)</span> <span class="token keyword">AS</span> total_quantity <span class="token keyword">FROM</span> Sales <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> product_id<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="项目员工i-1075"><a href="#项目员工i-1075" class="header-anchor">#</a> 项目员工I(1075)</h3> <blockquote><p>AVG求平均值，ROUND确定精度</p></blockquote> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> t1<span class="token punctuation">.</span>project_id<span class="token punctuation">,</span> <span class="token function">ROUND</span><span class="token punctuation">(</span><span class="token function">AVG</span><span class="token punctuation">(</span>t2<span class="token punctuation">.</span>experience_years<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> average_years
<span class="token keyword">FROM</span> Project t1
	<span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> Employee t2 <span class="token keyword">ON</span> t1<span class="token punctuation">.</span>employee_id <span class="token operator">=</span> t2<span class="token punctuation">.</span>employee_id
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> t1<span class="token punctuation">.</span>project_id<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="项目员工i-1076"><a href="#项目员工i-1076" class="header-anchor">#</a> 项目员工I(1076)</h3> <blockquote><p>查询项目中员工最多的项目，值得注意的是有可能有多个项目员工并列最多</p></blockquote> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> project_id
<span class="token keyword">FROM</span> Project
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> project_id
<span class="token keyword">HAVING</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span>
	<span class="token keyword">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> num
	<span class="token keyword">FROM</span> Project
	<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> project_id
	<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">DESC</span>
	<span class="token keyword">LIMIT</span> <span class="token number">1</span>
<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="产品分析i-1082"><a href="#产品分析i-1082" class="header-anchor">#</a> 产品分析I(1082)</h3> <blockquote><p>查询总销售额最高的销售者，可能有销售额相等者</p></blockquote> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> seller_id
<span class="token keyword">FROM</span> Sales
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> seller_id
<span class="token keyword">HAVING</span> <span class="token function">SUM</span><span class="token punctuation">(</span>price<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span>
	<span class="token keyword">SELECT</span> <span class="token function">SUM</span><span class="token punctuation">(</span>price<span class="token punctuation">)</span> <span class="token keyword">AS</span> num
	<span class="token keyword">FROM</span> Sales
	<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> seller_id
	<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token function">SUM</span><span class="token punctuation">(</span>price<span class="token punctuation">)</span> <span class="token keyword">DESC</span>
	<span class="token keyword">LIMIT</span> <span class="token number">1</span>
<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="产品分析ii-1083"><a href="#产品分析ii-1083" class="header-anchor">#</a> 产品分析II(1083)</h3> <blockquote><p>找出购买了 S8 但没有购买 Iphon的用户</p></blockquote> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> t1<span class="token punctuation">.</span>buyer_id
<span class="token keyword">FROM</span> Sales t1
	<span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> Product t2 <span class="token keyword">ON</span> t1<span class="token punctuation">.</span>product_id <span class="token operator">=</span> t2<span class="token punctuation">.</span>product_id
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> t1<span class="token punctuation">.</span>buyer_id
<span class="token keyword">HAVING</span> <span class="token function">SUM</span><span class="token punctuation">(</span>t2<span class="token punctuation">.</span>product_name <span class="token operator">=</span> <span class="token string">'S8'</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span>
<span class="token operator">AND</span> <span class="token function">SUM</span><span class="token punctuation">(</span>t2<span class="token punctuation">.</span>product_name <span class="token operator">=</span> <span class="token string">'iPhone'</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><blockquote><p>也可以使用 In 和 NOT In来求解</p></blockquote> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token keyword">DISTINCT</span> buyer_id
<span class="token keyword">FROM</span> Sales
<span class="token keyword">WHERE</span> buyer_id <span class="token operator">IN</span> <span class="token punctuation">(</span>
		<span class="token keyword">SELECT</span> t1<span class="token punctuation">.</span>buyer_id
		<span class="token keyword">FROM</span> Sales t1
			<span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> Product t2 <span class="token keyword">ON</span> t1<span class="token punctuation">.</span>product_id <span class="token operator">=</span> t2<span class="token punctuation">.</span>product_id
		<span class="token keyword">WHERE</span> t2<span class="token punctuation">.</span>product_name <span class="token operator">=</span> <span class="token string">'S8'</span>
	<span class="token punctuation">)</span>
	<span class="token operator">AND</span> buyer_id <span class="token operator">NOT</span> <span class="token operator">IN</span> <span class="token punctuation">(</span>
		<span class="token keyword">SELECT</span> t3<span class="token punctuation">.</span>buyer_id
		<span class="token keyword">FROM</span> Sales t3
			<span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> Product t4 <span class="token keyword">ON</span> t3<span class="token punctuation">.</span>product_id <span class="token operator">=</span> t4<span class="token punctuation">.</span>product_id
		<span class="token keyword">WHERE</span> t4<span class="token punctuation">.</span>product_name <span class="token operator">=</span> <span class="token string">'iPhone'</span>
	<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h3 id="产品分析iii-1084"><a href="#产品分析iii-1084" class="header-anchor">#</a> 产品分析III(1084)</h3> <blockquote><p>找出仅在 '2019-01-01' 到 '2019-03-31' 之间销售的产品</p> <p>使用<code>NOT BETWEEN ... AND ...</code></p></blockquote> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token keyword">DISTINCT</span> t1<span class="token punctuation">.</span>product_id<span class="token punctuation">,</span> t2<span class="token punctuation">.</span>product_name
<span class="token keyword">FROM</span> Sales t1
	<span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> Product t2 <span class="token keyword">ON</span> t1<span class="token punctuation">.</span>product_id <span class="token operator">=</span> t2<span class="token punctuation">.</span>product_id
<span class="token keyword">WHERE</span> t1<span class="token punctuation">.</span>sale_date <span class="token operator">BETWEEN</span> <span class="token string">'2019-01-01'</span> <span class="token operator">AND</span> <span class="token string">'2019-03-31'</span>
	<span class="token operator">AND</span> t1<span class="token punctuation">.</span>product_id <span class="token operator">NOT</span> <span class="token operator">IN</span> <span class="token punctuation">(</span>
		<span class="token keyword">SELECT</span> product_id
		<span class="token keyword">FROM</span> Sales
		<span class="token keyword">WHERE</span> sale_date <span class="token operator">NOT</span> <span class="token operator">BETWEEN</span> <span class="token string">'2019-01-01'</span> <span class="token operator">AND</span> <span class="token string">'2019-03-31'</span>
	<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="文章浏览-1148"><a href="#文章浏览-1148" class="header-anchor">#</a> 文章浏览(1148)</h3> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token keyword">distinct</span> author_id <span class="token keyword">AS</span> id <span class="token keyword">FROM</span> Views <span class="token keyword">WHERE</span> author_id <span class="token operator">=</span> viewer_id <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> id<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="重新格式化部门表-1179"><a href="#重新格式化部门表-1179" class="header-anchor">#</a> 重新格式化部门表(1179)</h3> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> id<span class="token punctuation">,</span> 
<span class="token function">SUM</span><span class="token punctuation">(</span><span class="token keyword">IF</span><span class="token punctuation">(</span><span class="token keyword">month</span> <span class="token operator">=</span> <span class="token string">'Jan'</span><span class="token punctuation">,</span> revenue<span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> Jan_Revenue<span class="token punctuation">,</span>
<span class="token function">SUM</span><span class="token punctuation">(</span><span class="token keyword">IF</span><span class="token punctuation">(</span><span class="token keyword">month</span> <span class="token operator">=</span> <span class="token string">'Feb'</span><span class="token punctuation">,</span> revenue<span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> Feb_Revenue<span class="token punctuation">,</span>
<span class="token function">SUM</span><span class="token punctuation">(</span><span class="token keyword">IF</span><span class="token punctuation">(</span><span class="token keyword">month</span> <span class="token operator">=</span> <span class="token string">'Mar'</span><span class="token punctuation">,</span> revenue<span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> Mar_Revenue<span class="token punctuation">,</span>
<span class="token function">SUM</span><span class="token punctuation">(</span><span class="token keyword">IF</span><span class="token punctuation">(</span><span class="token keyword">month</span> <span class="token operator">=</span> <span class="token string">'Apr'</span><span class="token punctuation">,</span> revenue<span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> Apr_Revenue<span class="token punctuation">,</span>
<span class="token function">SUM</span><span class="token punctuation">(</span><span class="token keyword">IF</span><span class="token punctuation">(</span><span class="token keyword">month</span> <span class="token operator">=</span> <span class="token string">'May'</span><span class="token punctuation">,</span> revenue<span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> May_Revenue<span class="token punctuation">,</span>
<span class="token function">SUM</span><span class="token punctuation">(</span><span class="token keyword">IF</span><span class="token punctuation">(</span><span class="token keyword">month</span> <span class="token operator">=</span> <span class="token string">'Jun'</span><span class="token punctuation">,</span> revenue<span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> Jun_Revenue<span class="token punctuation">,</span>
<span class="token function">SUM</span><span class="token punctuation">(</span><span class="token keyword">IF</span><span class="token punctuation">(</span><span class="token keyword">month</span> <span class="token operator">=</span> <span class="token string">'Jul'</span><span class="token punctuation">,</span> revenue<span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> Jul_Revenue<span class="token punctuation">,</span>
<span class="token function">SUM</span><span class="token punctuation">(</span><span class="token keyword">IF</span><span class="token punctuation">(</span><span class="token keyword">month</span> <span class="token operator">=</span> <span class="token string">'Aug'</span><span class="token punctuation">,</span> revenue<span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> Aug_Revenue<span class="token punctuation">,</span>
<span class="token function">SUM</span><span class="token punctuation">(</span><span class="token keyword">IF</span><span class="token punctuation">(</span><span class="token keyword">month</span> <span class="token operator">=</span> <span class="token string">'Sep'</span><span class="token punctuation">,</span> revenue<span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> Sep_Revenue<span class="token punctuation">,</span>
<span class="token function">SUM</span><span class="token punctuation">(</span><span class="token keyword">IF</span><span class="token punctuation">(</span><span class="token keyword">month</span> <span class="token operator">=</span> <span class="token string">'Oct'</span><span class="token punctuation">,</span> revenue<span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> Oct_Revenue<span class="token punctuation">,</span>
<span class="token function">SUM</span><span class="token punctuation">(</span><span class="token keyword">IF</span><span class="token punctuation">(</span><span class="token keyword">month</span> <span class="token operator">=</span> <span class="token string">'Nov'</span><span class="token punctuation">,</span> revenue<span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> Nov_Revenue<span class="token punctuation">,</span>
<span class="token function">SUM</span><span class="token punctuation">(</span><span class="token keyword">IF</span><span class="token punctuation">(</span><span class="token keyword">month</span> <span class="token operator">=</span> <span class="token string">'Dec'</span><span class="token punctuation">,</span> revenue<span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> Dec_Revenue
<span class="token keyword">FROM</span> Department <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> id
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h3 id="每个帖子的评论数-1241"><a href="#每个帖子的评论数-1241" class="header-anchor">#</a> 每个帖子的评论数(1241)</h3> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span>
	post_id<span class="token punctuation">,</span>
	<span class="token function">COUNT</span><span class="token punctuation">(</span> <span class="token keyword">DISTINCT</span> S2<span class="token punctuation">.</span>sub_id <span class="token punctuation">)</span> <span class="token keyword">AS</span> number_of_comments 
<span class="token keyword">FROM</span>
	<span class="token punctuation">(</span> <span class="token keyword">SELECT</span> <span class="token keyword">DISTINCT</span> sub_id <span class="token keyword">AS</span> post_id <span class="token keyword">FROM</span> Submissions <span class="token keyword">WHERE</span> parent_id <span class="token operator">IS</span> <span class="token boolean">NULL</span> <span class="token punctuation">)</span> S1
	<span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> Submissions S2 <span class="token keyword">ON</span> S1<span class="token punctuation">.</span>post_id <span class="token operator">=</span> S2<span class="token punctuation">.</span>parent_id 
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> S1<span class="token punctuation">.</span>post_id
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="中等"><a href="#中等" class="header-anchor">#</a> 中等</h2> <h3 id="分数排名-178"><a href="#分数排名-178" class="header-anchor">#</a> 分数排名(178)</h3> <blockquote><p>通过自连接的方式,查找出大于等于它的成绩的数量即为其排名，整理排序即得结果</p></blockquote> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> a<span class="token punctuation">.</span>Score <span class="token keyword">AS</span> Score<span class="token punctuation">,</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token keyword">DISTINCT</span> b<span class="token punctuation">.</span>Score<span class="token punctuation">)</span> <span class="token keyword">AS</span> Rank
<span class="token keyword">FROM</span> Scores a<span class="token punctuation">,</span> Scores b
<span class="token keyword">WHERE</span> b<span class="token punctuation">.</span>Score <span class="token operator">&gt;=</span> a<span class="token punctuation">.</span>Score
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> a<span class="token punctuation">.</span>id
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> a<span class="token punctuation">.</span>Score <span class="token keyword">DESC</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="连续出现的数字-180"><a href="#连续出现的数字-180" class="header-anchor">#</a> 连续出现的数字(180)</h3> <blockquote><p>查找所有至少连续出现三次的数字</p></blockquote> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token keyword">DISTINCT</span> t1<span class="token punctuation">.</span>Num <span class="token keyword">AS</span> ConsecutiveNums
<span class="token keyword">FROM</span> Logs t1<span class="token punctuation">,</span> Logs t2<span class="token punctuation">,</span> Logs t3
<span class="token keyword">WHERE</span> <span class="token punctuation">(</span>t1<span class="token punctuation">.</span>Num <span class="token operator">=</span> t2<span class="token punctuation">.</span>Num
	<span class="token operator">AND</span> t2<span class="token punctuation">.</span>Num <span class="token operator">=</span> t3<span class="token punctuation">.</span>Num
	<span class="token operator">AND</span> t1<span class="token punctuation">.</span>Id <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">=</span> t2<span class="token punctuation">.</span>Id
	<span class="token operator">AND</span> t2<span class="token punctuation">.</span>Id <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">=</span> t3<span class="token punctuation">.</span>Id<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="部门中最高的工资-184"><a href="#部门中最高的工资-184" class="header-anchor">#</a> 部门中最高的工资(184)</h3> <blockquote><p>通过 <code>IN</code> max(Salary)</p></blockquote> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> t2<span class="token punctuation">.</span>name <span class="token keyword">AS</span> <span class="token string">'Department'</span><span class="token punctuation">,</span> t1<span class="token punctuation">.</span>name <span class="token keyword">AS</span> <span class="token string">'Employee'</span><span class="token punctuation">,</span> t1<span class="token punctuation">.</span>Salary
<span class="token keyword">FROM</span> Employee t1
	<span class="token keyword">JOIN</span> Department t2 <span class="token keyword">ON</span> t1<span class="token punctuation">.</span>DepartmentId <span class="token operator">=</span> t2<span class="token punctuation">.</span>Id
<span class="token keyword">WHERE</span> <span class="token punctuation">(</span>t1<span class="token punctuation">.</span>DepartmentId<span class="token punctuation">,</span> t1<span class="token punctuation">.</span>Salary<span class="token punctuation">)</span> <span class="token operator">IN</span> <span class="token punctuation">(</span>
	<span class="token keyword">SELECT</span> DepartmentId<span class="token punctuation">,</span> <span class="token function">MAX</span><span class="token punctuation">(</span>Salary<span class="token punctuation">)</span>
	<span class="token keyword">FROM</span> Employee
	<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> DepartmentId
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="找出至少有五名下属的经理-570"><a href="#找出至少有五名下属的经理-570" class="header-anchor">#</a> 找出至少有五名下属的经理(570)</h3> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> Name
<span class="token keyword">FROM</span> Employee
<span class="token keyword">WHERE</span> Id <span class="token operator">IN</span> <span class="token punctuation">(</span>
	<span class="token keyword">SELECT</span> ManagerId
	<span class="token keyword">FROM</span> Employee
	<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> ManagerId
	<span class="token keyword">HAVING</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">5</span>
<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="找出记录最多者-574"><a href="#找出记录最多者-574" class="header-anchor">#</a> 找出记录最多者(574)</h3> <blockquote><p>使用 ORDER 排序，然后用Limit 1获取最多者</p></blockquote> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> Name
<span class="token keyword">FROM</span> Candidate
<span class="token keyword">WHERE</span> id <span class="token operator">=</span> <span class="token punctuation">(</span>
	<span class="token keyword">SELECT</span> CandidateId
	<span class="token keyword">FROM</span> <span class="token punctuation">(</span>
		<span class="token keyword">SELECT</span> CandidateId
		<span class="token keyword">FROM</span> Vote
		<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> CandidateId
		<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">DESC</span>
		<span class="token keyword">LIMIT</span> <span class="token number">1</span>
	<span class="token punctuation">)</span> t2
<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="找出回答率最高的问题-578"><a href="#找出回答率最高的问题-578" class="header-anchor">#</a> 找出回答率最高的问题(578)</h3> <blockquote><p>通过 action和question_id进行分组统计，使用limit 1获取最多的那个</p></blockquote> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> question_id <span class="token keyword">AS</span> survey_log
<span class="token keyword">FROM</span> survey_log
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token keyword">action</span><span class="token punctuation">,</span> question_id
<span class="token keyword">HAVING</span> <span class="token keyword">action</span> <span class="token operator">=</span> <span class="token string">'answer'</span>
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">DESC</span>
<span class="token keyword">LIMIT</span> <span class="token number">1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="统计各专业学生人数-580"><a href="#统计各专业学生人数-580" class="header-anchor">#</a> 统计各专业学生人数(580)</h3> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> t1<span class="token punctuation">.</span>dept_name<span class="token punctuation">,</span> <span class="token function">COUNT</span><span class="token punctuation">(</span>t2<span class="token punctuation">.</span>student_id<span class="token punctuation">)</span> <span class="token keyword">AS</span> student_number
<span class="token keyword">FROM</span> department t1
	<span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> student t2 <span class="token keyword">ON</span> t1<span class="token punctuation">.</span>dept_id <span class="token operator">=</span> t2<span class="token punctuation">.</span>dept_id
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> t1<span class="token punctuation">.</span>dept_id
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> student_number <span class="token keyword">DESC</span><span class="token punctuation">,</span> t1<span class="token punctuation">.</span>dept_name
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="_2016年的投资-585"><a href="#_2016年的投资-585" class="header-anchor">#</a> 2016年的投资(585)</h3> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span>
    <span class="token function">SUM</span><span class="token punctuation">(</span>insurance<span class="token punctuation">.</span>TIV_2016<span class="token punctuation">)</span> <span class="token keyword">AS</span> TIV_2016
<span class="token keyword">FROM</span>
    insurance
<span class="token keyword">WHERE</span>
    insurance<span class="token punctuation">.</span>TIV_2015 <span class="token operator">IN</span>
<span class="token punctuation">(</span><span class="token keyword">SELECT</span> TIV_2015 <span class="token keyword">FROM</span> insurance <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> TIV_2015 <span class="token keyword">HAVING</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span>
<span class="token operator">AND</span> CONCAT<span class="token punctuation">(</span>LAT<span class="token punctuation">,</span> LON<span class="token punctuation">)</span> <span class="token operator">IN</span>
<span class="token punctuation">(</span><span class="token keyword">SELECT</span> CONCAT<span class="token punctuation">(</span>LAT<span class="token punctuation">,</span> LON<span class="token punctuation">)</span> <span class="token keyword">FROM</span> insurance  <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> LAT <span class="token punctuation">,</span> LON <span class="token keyword">HAVING</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="好友申请-ii-谁有最多的好友-602"><a href="#好友申请-ii-谁有最多的好友-602" class="header-anchor">#</a> 好友申请 II ：谁有最多的好友(602)</h3> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> id<span class="token punctuation">,</span>num <span class="token keyword">FROM</span> <span class="token punctuation">(</span>
<span class="token keyword">SELECT</span> id<span class="token punctuation">,</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">as</span> num <span class="token keyword">FROM</span> <span class="token punctuation">(</span>
    <span class="token keyword">SELECT</span> requester_id <span class="token keyword">as</span> id <span class="token keyword">FROM</span> request_accepted <span class="token keyword">UNION</span> <span class="token keyword">ALL</span> 
    <span class="token keyword">SELECT</span> accepter_id <span class="token keyword">FROM</span> request_accepted
<span class="token punctuation">)</span> <span class="token keyword">as</span> t1 <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> id <span class="token punctuation">)</span> <span class="token keyword">as</span> t2 <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> num <span class="token keyword">DESC</span> <span class="token keyword">limit</span> <span class="token number">1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="树节点-608"><a href="#树节点-608" class="header-anchor">#</a> 树节点(608)</h3> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">select</span> id<span class="token punctuation">,</span>
<span class="token keyword">case</span> <span class="token keyword">when</span> t<span class="token punctuation">.</span>p_id <span class="token operator">is</span> <span class="token boolean">null</span> <span class="token keyword">then</span> <span class="token string">'Root'</span> 
     <span class="token keyword">when</span> t<span class="token punctuation">.</span>id <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token keyword">select</span> p_id <span class="token keyword">from</span> tree <span class="token punctuation">)</span> <span class="token keyword">then</span> <span class="token string">'Inner'</span>
     <span class="token keyword">else</span> <span class="token string">'Leaf'</span> 
     <span class="token keyword">end</span> <span class="token keyword">as</span> <span class="token keyword">Type</span>
<span class="token keyword">from</span> tree t 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="平面上的最近距离-612"><a href="#平面上的最近距离-612" class="header-anchor">#</a> 平面上的最近距离(612)</h3> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token function">MIN</span><span class="token punctuation">(</span><span class="token function">ROUND</span><span class="token punctuation">(</span>POW<span class="token punctuation">(</span>POW<span class="token punctuation">(</span>p1<span class="token punctuation">.</span>x<span class="token operator">-</span>p2<span class="token punctuation">.</span>x<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">+</span>POW<span class="token punctuation">(</span>p1<span class="token punctuation">.</span>y<span class="token operator">-</span>p2<span class="token punctuation">.</span>y<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">as</span> shortest 
<span class="token keyword">FROM</span> point_2d p1 <span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> point_2d p2 <span class="token keyword">ON</span> p1<span class="token punctuation">.</span>x<span class="token operator">!=</span>p2<span class="token punctuation">.</span>x <span class="token operator">OR</span> p1<span class="token punctuation">.</span>y<span class="token operator">!=</span>p2<span class="token punctuation">.</span>y
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="二级关注者-614"><a href="#二级关注者-614" class="header-anchor">#</a> 二级关注者(614)</h3> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">select</span> f1<span class="token punctuation">.</span>follower<span class="token punctuation">,</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token keyword">distinct</span> f2<span class="token punctuation">.</span>follower<span class="token punctuation">)</span> <span class="token keyword">as</span> num
<span class="token keyword">from</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token keyword">distinct</span> follower <span class="token keyword">from</span> follow<span class="token punctuation">)</span> f1 <span class="token keyword">join</span> follow f2 <span class="token keyword">on</span> f1<span class="token punctuation">.</span>follower <span class="token operator">=</span> f2<span class="token punctuation">.</span>followee
<span class="token keyword">group</span> <span class="token keyword">by</span> f1<span class="token punctuation">.</span>follower
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="换座位-626"><a href="#换座位-626" class="header-anchor">#</a> 换座位(626)</h3> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">select</span> <span class="token punctuation">(</span><span class="token keyword">case</span>
<span class="token keyword">when</span> id<span class="token operator">%</span><span class="token number">2</span><span class="token operator">=</span><span class="token number">0</span> <span class="token keyword">then</span> id<span class="token operator">-</span><span class="token number">1</span>
<span class="token keyword">when</span> id<span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token function">max</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token keyword">from</span> seat<span class="token punctuation">)</span> <span class="token keyword">then</span> id
<span class="token keyword">else</span> id<span class="token operator">+</span><span class="token number">1</span> <span class="token keyword">end</span><span class="token punctuation">)</span> <span class="token keyword">as</span> id <span class="token punctuation">,</span>student
<span class="token keyword">from</span> seat <span class="token keyword">order</span> <span class="token keyword">by</span> id<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="买下所有产品的客户-1045"><a href="#买下所有产品的客户-1045" class="header-anchor">#</a> 买下所有产品的客户(1045)</h3> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">select</span> customer_id
<span class="token keyword">from</span> 
<span class="token punctuation">(</span><span class="token keyword">select</span> customer_id<span class="token punctuation">,</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token keyword">distinct</span> product_key<span class="token punctuation">)</span> <span class="token keyword">as</span> num 
 <span class="token keyword">from</span> Customer
 <span class="token keyword">group</span> <span class="token keyword">by</span> customer_id
<span class="token punctuation">)</span> t
<span class="token keyword">join</span> <span class="token punctuation">(</span>
    <span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span>product_key<span class="token punctuation">)</span> <span class="token keyword">as</span> num
    <span class="token keyword">from</span> Product
<span class="token punctuation">)</span> m 
<span class="token keyword">on</span> t<span class="token punctuation">.</span>num <span class="token operator">=</span> m<span class="token punctuation">.</span>num<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="产品销售分析-iii-1070"><a href="#产品销售分析-iii-1070" class="header-anchor">#</a> 产品销售分析 III(1070)</h3> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">select</span>  
    product_id<span class="token punctuation">,</span>
    <span class="token keyword">year</span> first_year<span class="token punctuation">,</span>
    quantity<span class="token punctuation">,</span>
    price
<span class="token keyword">from</span> Sales
<span class="token keyword">where</span> <span class="token punctuation">(</span>product_id<span class="token punctuation">,</span><span class="token keyword">year</span><span class="token punctuation">)</span>
<span class="token operator">in</span> <span class="token punctuation">(</span><span class="token keyword">select</span> product_id<span class="token punctuation">,</span><span class="token function">min</span><span class="token punctuation">(</span><span class="token keyword">year</span><span class="token punctuation">)</span> <span class="token keyword">from</span> Sales <span class="token keyword">group</span> <span class="token keyword">by</span> product_id<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="项目员工-iii-1077"><a href="#项目员工-iii-1077" class="header-anchor">#</a> 项目员工 III(1077)</h3> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">select</span> p<span class="token punctuation">.</span>project_id<span class="token punctuation">,</span> p<span class="token punctuation">.</span>employee_id
<span class="token keyword">from</span> Project p
<span class="token keyword">join</span> Employee e
<span class="token keyword">on</span> p<span class="token punctuation">.</span>employee_id <span class="token operator">=</span> e<span class="token punctuation">.</span>employee_id
<span class="token keyword">where</span> <span class="token punctuation">(</span>p<span class="token punctuation">.</span>project_id<span class="token punctuation">,</span> e<span class="token punctuation">.</span>experience_years<span class="token punctuation">)</span> <span class="token operator">in</span> <span class="token punctuation">(</span>
<span class="token keyword">select</span> p<span class="token punctuation">.</span>project_id<span class="token punctuation">,</span><span class="token function">max</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>experience_years<span class="token punctuation">)</span>
<span class="token keyword">from</span> project p <span class="token keyword">join</span> employee e <span class="token keyword">on</span> p<span class="token punctuation">.</span>employee_id <span class="token operator">=</span> e<span class="token punctuation">.</span>employee_id
<span class="token keyword">group</span> <span class="token keyword">by</span> p<span class="token punctuation">.</span>project_id <span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="小众书籍-1098"><a href="#小众书籍-1098" class="header-anchor">#</a> 小众书籍(1098)</h3> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">select</span> book_id<span class="token punctuation">,</span>name
<span class="token keyword">from</span> Books
<span class="token keyword">where</span> book_id <span class="token operator">not</span> <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token keyword">select</span> book_id <span class="token keyword">from</span> Orders
<span class="token keyword">where</span> dispatch_date <span class="token operator">between</span> <span class="token string">'2019-06-23'</span><span class="token operator">-</span><span class="token keyword">interval</span> <span class="token number">1</span> <span class="token keyword">year</span> <span class="token operator">and</span> <span class="token string">'2019-06-23'</span>
<span class="token keyword">group</span> <span class="token keyword">by</span> book_id <span class="token keyword">having</span> <span class="token function">sum</span><span class="token punctuation">(</span>quantity<span class="token punctuation">)</span><span class="token operator">&gt;=</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">and</span> available_from<span class="token operator">&lt;</span><span class="token string">'2019-06-23'</span><span class="token operator">-</span><span class="token keyword">interval</span> <span class="token number">1</span> <span class="token keyword">month</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="每日新用户统计-1107"><a href="#每日新用户统计-1107" class="header-anchor">#</a> 每日新用户统计(1107)</h3> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> login_date<span class="token punctuation">,</span> <span class="token function">COUNT</span><span class="token punctuation">(</span>user_id<span class="token punctuation">)</span> <span class="token keyword">AS</span> user_count
<span class="token keyword">FROM</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> user_id<span class="token punctuation">,</span> <span class="token function">MIN</span><span class="token punctuation">(</span>activity_date<span class="token punctuation">)</span> <span class="token keyword">AS</span> login_date
      <span class="token keyword">FROM</span> Traffic
      <span class="token keyword">WHERE</span> activity <span class="token operator">=</span> <span class="token string">'login'</span>
      <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> user_id<span class="token punctuation">)</span> tmp
<span class="token keyword">WHERE</span> DATEDIFF<span class="token punctuation">(</span><span class="token string">'2019-06-30'</span><span class="token punctuation">,</span> login_date<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">90</span>
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> login_date
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> login_date
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="每位学生的最高成绩-1112"><a href="#每位学生的最高成绩-1112" class="header-anchor">#</a> 每位学生的最高成绩(1112)</h3> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">select</span> 
    t<span class="token punctuation">.</span>student_id<span class="token punctuation">,</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">count</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>grade<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">1</span> <span class="token punctuation">,</span><span class="token function">min</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>course_id<span class="token punctuation">)</span><span class="token punctuation">,</span>course_id<span class="token punctuation">)</span> <span class="token keyword">as</span> course_id<span class="token punctuation">,</span>
    t<span class="token punctuation">.</span>max1 <span class="token keyword">as</span> grade
<span class="token keyword">from</span> Enrollments e 
<span class="token keyword">right</span> <span class="token keyword">join</span> <span class="token punctuation">(</span><span class="token keyword">select</span> student_id<span class="token punctuation">,</span><span class="token function">max</span><span class="token punctuation">(</span>grade<span class="token punctuation">)</span> <span class="token keyword">as</span> max1  <span class="token keyword">from</span> Enrollments <span class="token keyword">group</span> <span class="token keyword">by</span> student_id <span class="token punctuation">)</span>t
    <span class="token keyword">on</span> t<span class="token punctuation">.</span>student_id<span class="token operator">=</span>e<span class="token punctuation">.</span>student_id <span class="token operator">and</span> t<span class="token punctuation">.</span>max1 <span class="token operator">=</span> e<span class="token punctuation">.</span>grade
<span class="token keyword">group</span> <span class="token keyword">by</span> e<span class="token punctuation">.</span>student_id 
<span class="token keyword">order</span> <span class="token keyword">by</span> t<span class="token punctuation">.</span>student_id<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="每月交易-i-1193"><a href="#每月交易-i-1193" class="header-anchor">#</a> 每月交易 I(1193)</h3> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">select</span>
date_format<span class="token punctuation">(</span>trans_date<span class="token punctuation">,</span><span class="token string">'%Y-%m'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token keyword">month</span><span class="token punctuation">,</span>
country<span class="token punctuation">,</span>
<span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">as</span> trans_count<span class="token punctuation">,</span>
<span class="token function">sum</span><span class="token punctuation">(</span><span class="token keyword">if</span><span class="token punctuation">(</span>state<span class="token operator">=</span><span class="token string">'approved'</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">as</span> approved_count<span class="token punctuation">,</span>
<span class="token function">sum</span><span class="token punctuation">(</span>amount<span class="token punctuation">)</span> <span class="token keyword">as</span> trans_total_amount<span class="token punctuation">,</span>
<span class="token function">sum</span><span class="token punctuation">(</span><span class="token keyword">if</span><span class="token punctuation">(</span>state<span class="token operator">=</span><span class="token string">'approved'</span><span class="token punctuation">,</span>amount<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">as</span> approved_total_amount
<span class="token keyword">from</span> <span class="token keyword">Transactions</span> t
<span class="token keyword">group</span> <span class="token keyword">by</span>
date_format<span class="token punctuation">(</span>trans_date<span class="token punctuation">,</span><span class="token string">'%Y-%m'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>country
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="每月交易ii-1205"><a href="#每月交易ii-1205" class="header-anchor">#</a> 每月交易II(1205)</h3> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">select</span>
<span class="token keyword">month</span><span class="token punctuation">,</span>
country<span class="token punctuation">,</span>
<span class="token function">sum</span><span class="token punctuation">(</span><span class="token keyword">case</span> <span class="token keyword">when</span> state <span class="token operator">=</span> <span class="token string">'approved'</span> <span class="token keyword">then</span> <span class="token number">1</span> <span class="token keyword">else</span> <span class="token number">0</span> <span class="token keyword">end</span><span class="token punctuation">)</span> <span class="token keyword">as</span> approved_count<span class="token punctuation">,</span>
<span class="token function">sum</span><span class="token punctuation">(</span><span class="token keyword">case</span> <span class="token keyword">when</span> state <span class="token operator">=</span> <span class="token string">'approved'</span> <span class="token keyword">then</span> amount <span class="token keyword">else</span> <span class="token number">0</span> <span class="token keyword">end</span><span class="token punctuation">)</span> <span class="token keyword">as</span> approved_amount<span class="token punctuation">,</span>
<span class="token function">sum</span><span class="token punctuation">(</span><span class="token keyword">case</span> <span class="token keyword">when</span> state <span class="token operator">=</span> <span class="token string">'charged'</span> <span class="token keyword">then</span> <span class="token number">1</span> <span class="token keyword">else</span> <span class="token number">0</span> <span class="token keyword">end</span><span class="token punctuation">)</span> <span class="token keyword">as</span> chargeback_count<span class="token punctuation">,</span>
<span class="token function">sum</span><span class="token punctuation">(</span><span class="token keyword">case</span> <span class="token keyword">when</span> state <span class="token operator">=</span> <span class="token string">'charged'</span> <span class="token keyword">then</span> amount <span class="token keyword">else</span> <span class="token number">0</span> <span class="token keyword">end</span><span class="token punctuation">)</span> <span class="token keyword">as</span> chargeback_amount
<span class="token keyword">from</span>
<span class="token punctuation">(</span>
<span class="token keyword">select</span> c<span class="token punctuation">.</span>trans_id <span class="token keyword">as</span> id<span class="token punctuation">,</span> t<span class="token punctuation">.</span>country<span class="token punctuation">,</span><span class="token string">'charged'</span> <span class="token keyword">as</span> state<span class="token punctuation">,</span>amount<span class="token punctuation">,</span>c<span class="token punctuation">.</span>trans_date<span class="token punctuation">,</span>date_format<span class="token punctuation">(</span>c<span class="token punctuation">.</span>trans_date<span class="token punctuation">,</span><span class="token string">'%Y-%m'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token keyword">month</span>
<span class="token keyword">from</span> chargebacks c
<span class="token keyword">left</span> <span class="token keyword">join</span> <span class="token keyword">transactions</span> t <span class="token keyword">on</span> c<span class="token punctuation">.</span>trans_id <span class="token operator">=</span> t<span class="token punctuation">.</span>id
<span class="token keyword">union</span> <span class="token keyword">all</span>
<span class="token keyword">select</span> <span class="token operator">*</span><span class="token punctuation">,</span>date_format<span class="token punctuation">(</span>trans_date<span class="token punctuation">,</span><span class="token string">'%Y-%m'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token keyword">month</span>
<span class="token keyword">from</span> <span class="token keyword">transactions</span>
<span class="token keyword">where</span> state <span class="token operator">=</span> <span class="token string">'approved'</span> <span class="token comment">#去零</span>
<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token keyword">temp</span>
<span class="token keyword">group</span> <span class="token keyword">by</span> <span class="token keyword">month</span><span class="token punctuation">,</span>country
<span class="token keyword">order</span> <span class="token keyword">by</span> <span class="token keyword">month</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h2 id="困难"><a href="#困难" class="header-anchor">#</a> 困难</h2> <h3 id="游戏玩法分析"><a href="#游戏玩法分析" class="header-anchor">#</a> 游戏玩法分析</h3> <ol><li>玩家第一天登录游戏日期(511)</li></ol> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> player_id<span class="token punctuation">,</span> <span class="token function">MIN</span><span class="token punctuation">(</span>event_date<span class="token punctuation">)</span>  <span class="token keyword">AS</span> first_login <span class="token keyword">FROM</span> Activity <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> player_id
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ol start="2"><li>玩家第一天登录游戏设备名称(512)</li></ol> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> player_id<span class="token punctuation">,</span> device_id
<span class="token keyword">FROM</span> Activity
<span class="token keyword">WHERE</span> <span class="token punctuation">(</span>player_id<span class="token punctuation">,</span> event_date<span class="token punctuation">)</span> <span class="token operator">IN</span> <span class="token punctuation">(</span>
	<span class="token keyword">SELECT</span> player_id<span class="token punctuation">,</span> <span class="token function">MIN</span><span class="token punctuation">(</span>event_date<span class="token punctuation">)</span>
	<span class="token keyword">FROM</span> Activity
	<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> player_id
<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ol start="3"><li>统计各个日期前玩家的登录次数(534)</li></ol> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> t2<span class="token punctuation">.</span>player_id<span class="token punctuation">,</span> t2<span class="token punctuation">.</span>event_date<span class="token punctuation">,</span> <span class="token function">SUM</span><span class="token punctuation">(</span>t1<span class="token punctuation">.</span>games_played<span class="token punctuation">)</span> <span class="token keyword">AS</span> games_played_so_far
<span class="token keyword">FROM</span> Activity t1
	<span class="token keyword">JOIN</span> Activity t2
	<span class="token keyword">ON</span> t1<span class="token punctuation">.</span>event_date <span class="token operator">&lt;=</span> t2<span class="token punctuation">.</span>event_date
		<span class="token operator">AND</span> t1<span class="token punctuation">.</span>player_id <span class="token operator">=</span> t2<span class="token punctuation">.</span>player_id
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> t2<span class="token punctuation">.</span>player_id<span class="token punctuation">,</span> t2<span class="token punctuation">.</span>event_date
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ol start="4"><li>求首次登陆之后，第二天也登陆的玩家占总玩家的比率(550)</li></ol> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token function">ROUND</span><span class="token punctuation">(</span><span class="token function">SUM</span><span class="token punctuation">(</span><span class="token keyword">IF</span><span class="token punctuation">(</span>DATEDIFF<span class="token punctuation">(</span>t1<span class="token punctuation">.</span>event_date<span class="token punctuation">,</span> t2<span class="token punctuation">.</span>first_date<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> 
        <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token keyword">DISTINCT</span> t1<span class="token punctuation">.</span>player_id<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> fraction
<span class="token keyword">FROM</span> Activity t1<span class="token punctuation">,</span> <span class="token punctuation">(</span>
		<span class="token keyword">SELECT</span> player_id<span class="token punctuation">,</span> <span class="token function">MIN</span><span class="token punctuation">(</span>event_date<span class="token punctuation">)</span> <span class="token keyword">AS</span> first_date
		<span class="token keyword">FROM</span> activity
		<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> player_id
	<span class="token punctuation">)</span> t2
<span class="token keyword">WHERE</span> t1<span class="token punctuation">.</span>player_id <span class="token operator">=</span> t2<span class="token punctuation">.</span>player_id
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="求各个公司薪水中位数-569"><a href="#求各个公司薪水中位数-569" class="header-anchor">#</a> 求各个公司薪水中位数(569)</h3> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> e1<span class="token punctuation">.</span>Id<span class="token punctuation">,</span> e1<span class="token punctuation">.</span>Company<span class="token punctuation">,</span> e1<span class="token punctuation">.</span>Salary
<span class="token keyword">FROM</span> Employee e1<span class="token punctuation">,</span> Employee e2
<span class="token keyword">WHERE</span> e1<span class="token punctuation">.</span>Company <span class="token operator">=</span> e2<span class="token punctuation">.</span>Company
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> e1<span class="token punctuation">.</span>Company<span class="token punctuation">,</span> e1<span class="token punctuation">.</span>Salary
<span class="token keyword">HAVING</span> <span class="token function">SUM</span><span class="token punctuation">(</span><span class="token keyword">CASE</span> 
	<span class="token keyword">WHEN</span> e1<span class="token punctuation">.</span>Salary <span class="token operator">&gt;=</span> e2<span class="token punctuation">.</span>Salary <span class="token keyword">THEN</span> <span class="token number">1</span>
	<span class="token keyword">ELSE</span> <span class="token number">0</span>
<span class="token keyword">END</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span>
<span class="token operator">AND</span> <span class="token function">SUM</span><span class="token punctuation">(</span><span class="token keyword">CASE</span> 
	<span class="token keyword">WHEN</span> e1<span class="token punctuation">.</span>Salary <span class="token operator">&lt;=</span> e2<span class="token punctuation">.</span>Salary <span class="token keyword">THEN</span> <span class="token number">1</span>
	<span class="token keyword">ELSE</span> <span class="token number">0</span>
<span class="token keyword">END</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span>
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> e1<span class="token punctuation">.</span>Company<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="行程和用户取消率-262"><a href="#行程和用户取消率-262" class="header-anchor">#</a> 行程和用户取消率(262)</h3> <blockquote><p>ROUND(x, d)  x: 要处理的数 d: 保留几位小数</p> <p>IF(表达式, x, y): 表达式为true时取 x, false时取 y, 类似于Java的三元表达式</p></blockquote> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> t1<span class="token punctuation">.</span>Request_at<span class="token punctuation">,</span> 
        <span class="token function">ROUND</span><span class="token punctuation">(</span><span class="token function">SUM</span><span class="token punctuation">(</span><span class="token keyword">IF</span><span class="token punctuation">(</span>t1<span class="token punctuation">.</span><span class="token keyword">Status</span> <span class="token operator">=</span> <span class="token string">'cancelled'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token function">COUNT</span><span class="token punctuation">(</span>t1<span class="token punctuation">.</span><span class="token keyword">Status</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token keyword">FROM</span> Trips t1
	<span class="token keyword">JOIN</span> Users t2
	<span class="token keyword">ON</span> t1<span class="token punctuation">.</span>Client_Id <span class="token operator">=</span> t2<span class="token punctuation">.</span>Users_Id
		<span class="token operator">AND</span> t2<span class="token punctuation">.</span>Banned <span class="token operator">=</span> <span class="token string">'No'</span>
	<span class="token keyword">JOIN</span> Users t3
	<span class="token keyword">ON</span> t1<span class="token punctuation">.</span>Driver_Id <span class="token operator">=</span> t3<span class="token punctuation">.</span>Users_Id
		<span class="token operator">AND</span> t3<span class="token punctuation">.</span>Banned <span class="token operator">=</span> <span class="token string">'No'</span>
<span class="token keyword">WHERE</span> t1<span class="token punctuation">.</span>Request_at <span class="token operator">BETWEEN</span> <span class="token string">'2013-10-01'</span> <span class="token operator">AND</span> <span class="token string">'2013-10-03'</span>
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> t1<span class="token punctuation">.</span>Request_at
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="给定数字的频率查询中位数-571"><a href="#给定数字的频率查询中位数-571" class="header-anchor">#</a> 给定数字的频率查询中位数(571)</h3> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">select</span>
<span class="token function">avg</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span>number<span class="token punctuation">)</span> <span class="token keyword">as</span> median
<span class="token keyword">from</span>
<span class="token punctuation">(</span>
<span class="token keyword">select</span>
n1<span class="token punctuation">.</span>number<span class="token punctuation">,</span>
n1<span class="token punctuation">.</span>frequency<span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token function">sum</span><span class="token punctuation">(</span>frequency<span class="token punctuation">)</span> <span class="token keyword">from</span> numbers n2 <span class="token keyword">where</span> n2<span class="token punctuation">.</span>number<span class="token operator">&lt;=</span>n1<span class="token punctuation">.</span>number<span class="token punctuation">)</span> <span class="token keyword">as</span> asc_frequency<span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token function">sum</span><span class="token punctuation">(</span>frequency<span class="token punctuation">)</span> <span class="token keyword">from</span> numbers n3 <span class="token keyword">where</span> n3<span class="token punctuation">.</span>number<span class="token operator">&gt;=</span>n1<span class="token punctuation">.</span>number<span class="token punctuation">)</span> <span class="token keyword">as</span> desc_frequency
<span class="token keyword">from</span> numbers n1
<span class="token punctuation">)</span> t
<span class="token keyword">where</span> t<span class="token punctuation">.</span>asc_frequency<span class="token operator">&gt;=</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token function">sum</span><span class="token punctuation">(</span>frequency<span class="token punctuation">)</span> <span class="token keyword">from</span> numbers<span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2</span>
<span class="token operator">and</span> t<span class="token punctuation">.</span>desc_frequency<span class="token operator">&gt;=</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token function">sum</span><span class="token punctuation">(</span>frequency<span class="token punctuation">)</span> <span class="token keyword">from</span> numbers<span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="查询员工的累计薪水-579"><a href="#查询员工的累计薪水-579" class="header-anchor">#</a> 查询员工的累计薪水(579)</h3> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span>
    E1<span class="token punctuation">.</span>id<span class="token punctuation">,</span>
    E1<span class="token punctuation">.</span><span class="token keyword">month</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span>IFNULL<span class="token punctuation">(</span>E1<span class="token punctuation">.</span>salary<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">+</span> IFNULL<span class="token punctuation">(</span>E2<span class="token punctuation">.</span>salary<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">+</span> IFNULL<span class="token punctuation">(</span>E3<span class="token punctuation">.</span>salary<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> Salary
<span class="token keyword">FROM</span>
    <span class="token punctuation">(</span><span class="token keyword">SELECT</span>
        id<span class="token punctuation">,</span> <span class="token function">MAX</span><span class="token punctuation">(</span><span class="token keyword">month</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> <span class="token keyword">month</span>
    <span class="token keyword">FROM</span>
        Employee
    <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> id
    <span class="token keyword">HAVING</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> maxmonth
        <span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span>
    Employee E1 <span class="token keyword">ON</span> <span class="token punctuation">(</span>maxmonth<span class="token punctuation">.</span>id <span class="token operator">=</span> E1<span class="token punctuation">.</span>id
        <span class="token operator">AND</span> maxmonth<span class="token punctuation">.</span><span class="token keyword">month</span> <span class="token operator">&gt;</span> E1<span class="token punctuation">.</span><span class="token keyword">month</span><span class="token punctuation">)</span>
        <span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span>
    Employee E2 <span class="token keyword">ON</span> <span class="token punctuation">(</span>E2<span class="token punctuation">.</span>id <span class="token operator">=</span> E1<span class="token punctuation">.</span>id
        <span class="token operator">AND</span> E2<span class="token punctuation">.</span><span class="token keyword">month</span> <span class="token operator">=</span> E1<span class="token punctuation">.</span><span class="token keyword">month</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span>
    Employee E3 <span class="token keyword">ON</span> <span class="token punctuation">(</span>E3<span class="token punctuation">.</span>id <span class="token operator">=</span> E1<span class="token punctuation">.</span>id
        <span class="token operator">AND</span> E3<span class="token punctuation">.</span><span class="token keyword">month</span> <span class="token operator">=</span> E1<span class="token punctuation">.</span><span class="token keyword">month</span> <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> id <span class="token keyword">ASC</span> <span class="token punctuation">,</span> <span class="token keyword">month</span> <span class="token keyword">DESC</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h3 id="体育馆的人流量-601"><a href="#体育馆的人流量-601" class="header-anchor">#</a> 体育馆的人流量(601)</h3> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token keyword">distinct</span> a<span class="token punctuation">.</span><span class="token operator">*</span>
<span class="token keyword">FROM</span> stadium <span class="token keyword">as</span> a<span class="token punctuation">,</span>stadium <span class="token keyword">as</span> b<span class="token punctuation">,</span>stadium <span class="token keyword">as</span> c
<span class="token keyword">where</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>id <span class="token operator">=</span> b<span class="token punctuation">.</span>id<span class="token operator">-</span><span class="token number">1</span> <span class="token operator">and</span> b<span class="token punctuation">.</span>id<span class="token operator">+</span><span class="token number">1</span> <span class="token operator">=</span> c<span class="token punctuation">.</span>id<span class="token punctuation">)</span> <span class="token operator">or</span>
       <span class="token punctuation">(</span>a<span class="token punctuation">.</span>id<span class="token operator">-</span><span class="token number">1</span> <span class="token operator">=</span> b<span class="token punctuation">.</span>id <span class="token operator">and</span> a<span class="token punctuation">.</span>id<span class="token operator">+</span><span class="token number">1</span> <span class="token operator">=</span> c<span class="token punctuation">.</span>id<span class="token punctuation">)</span> <span class="token operator">or</span>
       <span class="token punctuation">(</span>a<span class="token punctuation">.</span>id<span class="token operator">-</span><span class="token number">1</span> <span class="token operator">=</span> c<span class="token punctuation">.</span>id <span class="token operator">and</span> c<span class="token punctuation">.</span>id<span class="token operator">-</span><span class="token number">1</span> <span class="token operator">=</span> b<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token operator">and</span> <span class="token punctuation">(</span>a<span class="token punctuation">.</span>people<span class="token operator">&gt;=</span><span class="token number">100</span> <span class="token operator">and</span> b<span class="token punctuation">.</span>people<span class="token operator">&gt;=</span><span class="token number">100</span> <span class="token operator">and</span> c<span class="token punctuation">.</span>people<span class="token operator">&gt;=</span><span class="token number">100</span><span class="token punctuation">)</span>
<span class="token keyword">order</span> <span class="token keyword">by</span> a<span class="token punctuation">.</span>id<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="平均工资-部门与公司比较-615"><a href="#平均工资-部门与公司比较-615" class="header-anchor">#</a> 平均工资：部门与公司比较(615)</h3> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">select</span> department_salary<span class="token punctuation">.</span>pay_month<span class="token punctuation">,</span> department_id<span class="token punctuation">,</span>
<span class="token keyword">case</span>
  <span class="token keyword">when</span> department_avg<span class="token operator">&gt;</span>company_avg <span class="token keyword">then</span> <span class="token string">'higher'</span>
  <span class="token keyword">when</span> department_avg<span class="token operator">&lt;</span>company_avg <span class="token keyword">then</span> <span class="token string">'lower'</span>
  <span class="token keyword">else</span> <span class="token string">'same'</span>
<span class="token keyword">end</span> <span class="token keyword">as</span> comparison
<span class="token keyword">from</span>
<span class="token punctuation">(</span>
  <span class="token keyword">select</span> department_id<span class="token punctuation">,</span> <span class="token function">avg</span><span class="token punctuation">(</span>amount<span class="token punctuation">)</span> <span class="token keyword">as</span> department_avg<span class="token punctuation">,</span> date_format<span class="token punctuation">(</span>pay_date<span class="token punctuation">,</span> <span class="token string">'%Y-%m'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> pay_month
  <span class="token keyword">from</span> salary <span class="token keyword">join</span> employee <span class="token keyword">on</span> salary<span class="token punctuation">.</span>employee_id <span class="token operator">=</span> employee<span class="token punctuation">.</span>employee_id
  <span class="token keyword">group</span> <span class="token keyword">by</span> department_id<span class="token punctuation">,</span> pay_month
<span class="token punctuation">)</span> <span class="token keyword">as</span> department_salary
<span class="token keyword">join</span>
<span class="token punctuation">(</span>
  <span class="token keyword">select</span> <span class="token function">avg</span><span class="token punctuation">(</span>amount<span class="token punctuation">)</span> <span class="token keyword">as</span> company_avg<span class="token punctuation">,</span>  date_format<span class="token punctuation">(</span>pay_date<span class="token punctuation">,</span> <span class="token string">'%Y-%m'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> pay_month <span class="token keyword">from</span> salary <span class="token keyword">group</span> <span class="token keyword">by</span> date_format<span class="token punctuation">(</span>pay_date<span class="token punctuation">,</span> <span class="token string">'%Y-%m'</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">as</span> company_salary
<span class="token keyword">on</span> department_salary<span class="token punctuation">.</span>pay_month <span class="token operator">=</span> company_salary<span class="token punctuation">.</span>pay_month
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h3 id="游戏玩法分析-v-1097"><a href="#游戏玩法分析-v-1097" class="header-anchor">#</a> 游戏玩法分析 V(1097)</h3> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> t0<span class="token punctuation">.</span>install_dt<span class="token punctuation">,</span> installs<span class="token punctuation">,</span> <span class="token function">ROUND</span><span class="token punctuation">(</span>IFNULL<span class="token punctuation">(</span>retention<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">/</span>installs<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> Day1_retention <span class="token keyword">FROM</span>
<span class="token punctuation">(</span><span class="token keyword">SELECT</span> install_dt<span class="token punctuation">,</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> installs <span class="token keyword">FROM</span> 
<span class="token punctuation">(</span><span class="token keyword">SELECT</span> player_id<span class="token punctuation">,</span> <span class="token function">MIN</span><span class="token punctuation">(</span>event_date<span class="token punctuation">)</span> install_dt <span class="token keyword">FROM</span> Activity <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> player_id<span class="token punctuation">)</span> t1
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> install_dt<span class="token punctuation">)</span> t0
<span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span>
<span class="token punctuation">(</span><span class="token keyword">SELECT</span> install_dt<span class="token punctuation">,</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> retention <span class="token keyword">FROM</span>
<span class="token punctuation">(</span><span class="token keyword">SELECT</span> player_id<span class="token punctuation">,</span> DATE_SUB<span class="token punctuation">(</span>event_date<span class="token punctuation">,</span> <span class="token keyword">INTERVAL</span> <span class="token number">1</span> <span class="token keyword">DAY</span><span class="token punctuation">)</span> install_dt <span class="token keyword">FROM</span> Activity <span class="token keyword">WHERE</span> <span class="token punctuation">(</span>player_id<span class="token punctuation">,</span> DATE_SUB<span class="token punctuation">(</span>event_date<span class="token punctuation">,</span> <span class="token keyword">INTERVAL</span> <span class="token number">1</span> <span class="token keyword">DAY</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">IN</span> 
<span class="token punctuation">(</span><span class="token keyword">SELECT</span> player_id<span class="token punctuation">,</span> <span class="token function">MIN</span><span class="token punctuation">(</span>event_date<span class="token punctuation">)</span> install_dt <span class="token keyword">FROM</span> Activity <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> player_id<span class="token punctuation">)</span>
 <span class="token punctuation">)</span> t3 <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> install_dt<span class="token punctuation">)</span> t4 <span class="token keyword">ON</span> t0<span class="token punctuation">.</span>install_dt <span class="token operator">=</span> t4<span class="token punctuation">.</span>install_dt 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="锦标赛优胜者-1194"><a href="#锦标赛优胜者-1194" class="header-anchor">#</a> 锦标赛优胜者(1194)</h3> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">select</span> group_id<span class="token punctuation">,</span>player_id <span class="token keyword">from</span> 
<span class="token punctuation">(</span><span class="token keyword">select</span> group_id<span class="token punctuation">,</span>player_id<span class="token punctuation">,</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token punctuation">(</span>
    <span class="token keyword">case</span> <span class="token keyword">when</span> player_id <span class="token operator">=</span> first_player <span class="token keyword">then</span> first_score
         <span class="token keyword">when</span> player_id <span class="token operator">=</span> second_player <span class="token keyword">then</span> second_score
         <span class="token keyword">end</span>
<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">as</span> totalScores
<span class="token keyword">from</span> Players p<span class="token punctuation">,</span>Matches m
<span class="token keyword">where</span> p<span class="token punctuation">.</span>player_id <span class="token operator">=</span> m<span class="token punctuation">.</span>first_player
<span class="token operator">or</span> p<span class="token punctuation">.</span>player_id <span class="token operator">=</span> m<span class="token punctuation">.</span>second_player
<span class="token keyword">group</span> <span class="token keyword">by</span> group_id<span class="token punctuation">,</span>player_id
<span class="token keyword">order</span> <span class="token keyword">by</span> group_id<span class="token punctuation">,</span>totalScores <span class="token keyword">desc</span><span class="token punctuation">,</span>player_id<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token keyword">temp</span>
<span class="token keyword">group</span> <span class="token keyword">by</span> group_id
<span class="token keyword">order</span> <span class="token keyword">by</span> group_id<span class="token punctuation">,</span>totalScores <span class="token keyword">desc</span><span class="token punctuation">,</span>player_id
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="报告系统状态的连续日期-1225"><a href="#报告系统状态的连续日期-1225" class="header-anchor">#</a> 报告系统状态的连续日期(1225)</h3> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">select</span> <span class="token keyword">status</span> <span class="token keyword">as</span> period_state<span class="token punctuation">,</span> <span class="token function">min</span><span class="token punctuation">(</span><span class="token keyword">date</span><span class="token punctuation">)</span> <span class="token keyword">as</span> start_date<span class="token punctuation">,</span> <span class="token function">max</span><span class="token punctuation">(</span><span class="token keyword">date</span><span class="token punctuation">)</span> <span class="token keyword">as</span> end_date
<span class="token keyword">from</span>
<span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token punctuation">(</span><span class="token keyword">select</span> fail_date <span class="token keyword">as</span> <span class="token keyword">date</span><span class="token punctuation">,</span> <span class="token string">'failed'</span> <span class="token keyword">as</span> <span class="token keyword">status</span><span class="token punctuation">,</span> <span class="token keyword">if</span><span class="token punctuation">(</span>datediff<span class="token punctuation">(</span><span class="token variable">@pre</span><span class="token punctuation">,</span> <span class="token variable">@pre</span> :<span class="token operator">=</span> fail_date<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token variable">@a</span><span class="token punctuation">,</span> <span class="token variable">@a</span> :<span class="token operator">=</span> <span class="token variable">@a</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">as</span> groupmark <span class="token keyword">from</span> Failed<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token variable">@a</span> :<span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token variable">@pre</span> :<span class="token operator">=</span> <span class="token string">&quot;2018-07-07&quot;</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token keyword">temp</span>
<span class="token keyword">union</span>
<span class="token keyword">select</span> success_date <span class="token keyword">as</span> <span class="token keyword">date</span><span class="token punctuation">,</span> <span class="token string">'succeeded'</span> <span class="token keyword">as</span> <span class="token keyword">status</span><span class="token punctuation">,</span> <span class="token keyword">if</span><span class="token punctuation">(</span>datediff<span class="token punctuation">(</span><span class="token variable">@cur</span><span class="token punctuation">,</span> <span class="token variable">@cur</span> :<span class="token operator">=</span> success_date<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token variable">@b</span><span class="token punctuation">,</span> <span class="token variable">@b</span> :<span class="token operator">=</span> <span class="token variable">@b</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">as</span> groupmark <span class="token keyword">from</span> Succeeded<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token variable">@b</span> :<span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token variable">@cur</span> :<span class="token operator">=</span> <span class="token string">&quot;2018-07-07&quot;</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token keyword">temp</span>
<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token keyword">temp</span> <span class="token keyword">where</span> <span class="token keyword">date</span> <span class="token operator">between</span> <span class="token string">&quot;2019-01-01&quot;</span> <span class="token operator">and</span> <span class="token string">&quot;2019-12-31&quot;</span>
<span class="token keyword">order</span> <span class="token keyword">by</span> <span class="token keyword">date</span><span class="token punctuation">)</span> <span class="token keyword">as</span> s
<span class="token keyword">group</span> <span class="token keyword">by</span> groupmark
<span class="token keyword">order</span> <span class="token keyword">by</span> <span class="token function">min</span><span class="token punctuation">(</span><span class="token keyword">date</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="批量修改表名"><a href="#批量修改表名" class="header-anchor">#</a> 批量修改表名</h3> <blockquote><p>sql查询语句有一个缺点，那就是一句SQL语句只能修改一张数据库的表名,如果你要精确修改某一张表，很好用。如果数据库表很多的话，比较麻烦。但是我们可以通过一条语句一次性生成所有的需要执行的sql语句：</p></blockquote> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">select</span> concat<span class="token punctuation">(</span><span class="token string">'alter table '</span><span class="token punctuation">,</span>table_name<span class="token punctuation">,</span><span class="token string">' rename to '</span><span class="token punctuation">,</span>table_name<span class="token punctuation">)</span> <span class="token keyword">from</span> information_schema<span class="token punctuation">.</span><span class="token keyword">tables</span> <span class="token keyword">where</span> table_name <span class="token operator">like</span><span class="token string">'dmsck_%'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="蠕虫复制"><a href="#蠕虫复制" class="header-anchor">#</a> 蠕虫复制</h3> <blockquote><p>sql查询语句有一个缺点，那就是一句SQL语句只能修改一张数据库的表名,如果你要精确修改某一张表，很好用。如果数据库表很多的话，比较麻烦。但是我们可以通过一条语句一次性生成所有的需要执行的sql语句：</p></blockquote> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> 表名 <span class="token number">1</span><span class="token punctuation">(</span>列 <span class="token number">1</span><span class="token punctuation">,</span> 列 <span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">SELECT</span> 列 <span class="token number">1</span><span class="token punctuation">,</span> 列 <span class="token number">2</span> <span class="token keyword">FROM</span> student<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></div> <footer class="page-edit" style="display:none;"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">10/20/2022, 4:07:09 PM</span></div></footer> <!----> <!----> <!----></main> <!----></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div><div class="kanbanniang" data-v-5775ee02><div class="banniang-container" style="display:;" data-v-5775ee02><div class="messageBox" style="right:68px;bottom:290px;display:none;" data-v-5775ee02>
      砸瓦鲁多
    </div> <div class="operation" style="right:90px;bottom:40px;display:;" data-v-5775ee02><i class="kbnfont kbn-ban-home ban-home" data-v-5775ee02></i> <i class="kbnfont kbn-ban-message message" data-v-5775ee02></i> <i class="kbnfont kbn-ban-close close" data-v-5775ee02></i> <a target="_blank" href="https://vuepress-theme-reco.recoluan.com/views/plugins/kanbanniang.html" data-v-5775ee02><i class="kbnfont kbn-ban-info info" data-v-5775ee02></i></a> <i class="kbnfont kbn-ban-theme skin" style="display:;" data-v-5775ee02></i></div> <canvas id="banniang" width="250" height="320" class="live2d" style="right:90px;bottom:-20px;opacity:0.9;" data-v-5775ee02></canvas></div> <div class="showBanNiang" style="display:none;" data-v-5775ee02>
    看板娘
  </div></div></div></div>
    <script src="/assets/js/app.645d1ab6.js" defer></script><script src="/assets/js/3.ec5dfed0.js" defer></script><script src="/assets/js/2.0591ec21.js" defer></script><script src="/assets/js/1.e902e43f.js" defer></script><script src="/assets/js/54.714206a8.js" defer></script>
  </body>
</html>
